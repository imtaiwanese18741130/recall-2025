<!DOCTYPE html>
<html lang="zh-Hant">
<head>
	<script src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script>
	<script src="{{.BaseURL}}/assets/js/home.js?v0.0.14" defer></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css" />
	{{ template "common-head" . }}
	<title>守護我們珍愛的臺灣，我們需要你！</title>
	<meta name="description" property="og:description" content="臺灣是個溫暖內斂、豐富多元的土地。面對黑夜、面對風雨，我們不曾讓希望就此熄滅，也從不允許自己就此墮入黑暗。為了保護所愛，我們總是負重前行，在困境中變得無比堅強。我們是臺灣人，溫柔而堅毅。每個犧牲休息、日曬雨淋的志工，每張細心撰寫的連署書，是守護這塊土地，溫柔而又堅定的行動。無論你在哪裡，我們需要你的加入，一起守護臺灣。">
</head>
<body>
	<div class="banner image" style="background-image:url('{{.BaseURL}}/assets/images/banner.png');">
		<div class="section nav">
			<div class="logo"><img src="{{.BaseURL}}/assets/images/logo-ourtaiwan.png"></div>
			<div class="nav-qrcode"><i class="icon-qrcode-reverse"></i></div>
		</div>
		<div class="section">
			<h1 class="primary">守護我們珍愛的臺灣，<br>我們需要你！</h1>
			<div class="content-text">臺灣是個溫暖內斂、豐富多元的土地。<br>面對黑夜、面對風雨，我們不曾讓希望就此熄滅，也從不允許自己就此墮入黑暗。<br>為了保護所愛，我們總是負重前行，在困境中變得無比堅強。<br><br>我們是臺灣人，溫柔而堅毅。<br>每個犧牲休息、日曬雨淋的志工，每張細心撰寫的連署書，是守護這塊土地，溫柔而又堅定的行動。無論你在哪裡，我們需要你的加入，一起守護臺灣。</div>
		</div>
	</div>
	<div class="section candidates">
		<div class="filters pb-sm">
			<h2>輸入戶籍地，<br>找出您有權罷免的立委</h2>
			<div class="row">
				<div id="municipalities-filter-wrapper" class="col-6 col-xs-12">
					<div class="row">
						<div class="filter-back">
							<button id="filter-municipalities-back-btn"><i class="icon-go-back"></i></button>
						</div>
						<input type="text" id="filter-municipalities-input-view" placeholder="縣市" readonly disabled>
						<input type="text" id="filter-municipalities-input-typing" placeholder="縣市" disabled style="display:none;">
					</div>
					<ul id="filter-municipalities-ul"></ul>
				</div>
				<div id="districts-filter-wrapper" class="col-6 col-xs-12">
					<div class="row">
						<div class="filter-back">
							<button id="filter-districts-back-btn"><i class="icon-go-back"></i></button>
						</div>
						<input type="text" id="filter-districts-input-view" placeholder="行政區" readonly disabled>
						<input type="text" id="filter-districts-input-typing" placeholder="行政區" disabled style="display:none;">
					</div>
					<ul id="filter-districts-ul"></ul>
				</div>
				<div id="wards-filter-wrapper" class="col-12">
					<div class="row">
						<div class="filter-back">
							<button id="filter-wards-back-btn"><i class="icon-go-back"></i></button>
						</div>
						<input type="text" id="filter-wards-input-view" placeholder="鄉鎮村里" readonly disabled>
						<input type="text" id="filter-wards-input-typing" placeholder="鄉鎮村里" disabled style="display:none;">
					</div>
					<ul id="filter-wards-ul"></ul>
				</div>
			</div>
		</div>
		<div class="filtered-candidate-container" id="filtered-candidate-container" style="display:none;">
		</div>
		<div class="filtered-candidate-container safe" id="share-container" style="display:none;">
			<div class="candidate-container">
				<div class="candidate">
					<div class="candidate-name">您的選區不在本次活動範圍</div>
					<div class="candidate-zone">但我們也需要您的力量，幫忙分享資訊讓更多人參與！</div>
				</div>
				<button class="btn-black lg w100" onclick="shareCurrentLink('臺灣是個溫暖內斂、豐富多元的土地。面對黑夜、面對風雨，我們不曾讓希望就此熄滅，也從不允許自己就此墮入黑暗。為了保護所愛，我們總是負重前行，在困境中變得無比堅強。我們是臺灣人，溫柔而堅毅。每個犧牲休息、日曬雨淋的志工，每張細心撰寫的連署書，是守護這塊土地，溫柔而又堅定的行動。無論你在哪裡，我們需要你的加入，一起守護臺灣。')"><i class="icon-link"></i>幫忙分享資訊！</button>
			</div>
		</div>
	</div>

	<div class="section swiper">
		<div class="swiper-wrapper">
			<div class="swiper-slide">
				<h4><i class="icon-notify"></i>提醒：連署兩階段，<span>連署書要簽 2 次</span></h4>
				<p>第一階段連署 <span>⮕</span> 第二階段連署 <span>⮕</span> 第三階段投票。第一階段簽過，也要簽二階段喔！</p>
			</div>
			<div class="swiper-slide">
				<h4><i class="icon-notify"></i>提醒：加入<span>罷免行事曆</span>追蹤投票時程</h4>
				<p>填寫連署書外，也請加入罷免投票行事曆，以免錯過後續最重要的投票階段！</p>
			</div>
		</div>
		<div class="swiper-pagination"></div>
	</div>

	<div class="section municipalities">
		<div class="header">
			<h2 class="mt-lg">全臺罷免活動一覽</h2>
			<div class="description">填寫連署書外，也請加入罷免投票行事曆，<br>以免錯過後續最重要的投票階段！</div>
		</div>
		<div class="municipality-tag-container">
			{{- range $a := .Areas }}
			<div class="municipality-tag {{if eq $a.MunicipalityId 1}}active{{end}}" data-city="{{$a.MunicipalityId}}" onclick="toggleCityList('{{$a.MunicipalityId}}');">
				<i class="icon-checked {{if eq $a.MunicipalityId 1}}active{{end}}"></i>{{$a.MunicipalityName}}
			</div>
			{{- end}}
		</div>
		{{- range $a := .Areas }}
		<ul data-city="{{$a.MunicipalityId}}" style="{{if eq $a.MunicipalityId 1}}display:flex;{{end}}">
			{{- range $rl := $a.RecallLegislators}}
			<li class="{{- if eq $rl.RecallStatus "ABORTED"}}recall-failed{{- else if eq $rl.RecallStatus "FAILED"}}recall-failed{{- end}}">
				<div class="candidate-container-row">
					<div class="candidate">
						<div class="candidate-name">{{$rl.PoliticianName}}<div class="tag-stage stage-{{.RecallStage}}">{{.RecallStage}} 階</div>
						</div>
						<div class="candidate-zone">{{$rl.ConstituencyName}}</div>
						{{- if eq $rl.RecallStatus "ONGOING" }}
						<div class="urgency">
							<div class="safety-cutoff-date">
								{{- if ge $rl.DaysLeft 0}}
									<i class="icon-urgent"></i><i class="icon-urgent"></i><i class="icon-urgent"></i>罷團已開始造冊, 請盡速繳交
								{{- else }}
									{{- if $rl.IsShortage }}
										<i class="icon-urgent"></i><i class="icon-urgent"></i><i class="icon-urgent"></i>未達安全份數，請儘速連署繳交！
									{{- else }}
										數量已達安全份數
									{{- end }}
								{{- end }}
							</div>
						</div>
						{{- end }}
					</div>
					<div class="candidate-action">
						{{- if eq $rl.RecallStatus "ABORTED"}}
							<span class="lg fw400">連署未送件</span>
						{{- else if eq $rl.RecallStatus "FAILED"}}
							<span class="lg fw400">連署未通過</span>
						{{- else}}
							<button class="btn-secondary md w100" data-url="{{$rl.CalendarURL}}" data-has-maintainer="{{if $rl.HasCalendarMaintainer}}true{{else}}false{{end}}">+ 罷免行事曆</button>
						{{- end}}
					</div>
				</div>
			</li>
			{{- end}}
		</ul>
		{{- end}}
		<div class="pep-talk" style="display:none;">
			<div><i class="icon-notify"></i><strong>您的選區連署未通過嗎？</strong>別灰心，我們還是需要您的力量，支持其他選區進行中的罷免活動，幫忙分享資訊！</div>
			<button class="btn-black lg" onclick="shareCurrentLink('臺灣是個溫暖內斂、豐富多元的土地。面對黑夜、面對風雨，我們不曾讓希望就此熄滅，也從不允許自己就此墮入黑暗。為了保護所愛，我們總是負重前行，在困境中變得無比堅強。我們是臺灣人，溫柔而堅毅。每個犧牲休息、日曬雨淋的志工，每張細心撰寫的連署書，是守護這塊土地，溫柔而又堅定的行動。無論你在哪裡，我們需要你的加入，一起守護臺灣。')"><i class="icon-link"></i>分享</button>
		</div>
	</div>
	{{ template "faq" }}
	{{ template "footer" . }}
	{{ template "dialog" }}
	{{ template "mask" }}
	<script>
		const baseURL = '{{.BaseURL}}';
	
		document.addEventListener("DOMContentLoaded", () => {
			document.querySelector(".nav-qrcode").addEventListener("click", (() => {
				mask.classList.add('active');
				dialog.querySelector("h3").innerHTML = "守護我們珍愛的臺灣，<br>我們需要你！";
				dialog.querySelector(".content").innerHTML = `
				<div class="dialog-qrcode" id="qrcode-container">
					<div class="qrcode"></div>
					<div class="qr-logo"></div>
				</div>
				<div class="dialog-footer">
					<p>您可以下載 QR 碼圖檔，印出張貼在合適的宣傳地點，幫助更多民眾進行連署</p>
					<div class="dialog-action">
						<button class="btn-primary lg w100 flex-center"><i class="icon-download"></i>下載 QR 碼圖檔</button>
					</div>
				</div>
			`;
				const url = window.location.href;
				generateQRCode(url, 144);

				dialog.querySelector(".dialog-footer button").addEventListener("click", ( async () => {
					const url = window.location.origin + window.location.pathname;
					mask.classList.add('active');
					await new Promise(resolve => setTimeout(resolve, 10));
					await downloadQRCode(url);
					mask.classList.remove('active');
				}));

				mask.classList.remove('active');
				showDialog();
			}));

			document.querySelectorAll(".municipalities button[data-url]").forEach(elem => {
				elem.addEventListener("click", ( async (event) => {
					mask.classList.add('active');
					const elem = event.target;
					const calendarURL = elem.getAttribute("data-url");
					const hasMaintainer = elem.getAttribute("data-has-maintainer");
					const li = elem.closest("li");
					const lagislatorName = li.querySelector("li .candidate-name").firstChild.textContent;
					const constituencyName = li.querySelector("li .candidate-zone").innerHTML;
					dialog.querySelector("h3").innerHTML = `罷免行事曆<br>${constituencyName} - ${lagislatorName}`;
					dialog.querySelector(".content").innerHTML = `
						<div class="dialog-calendar-status">
							${hasMaintainer === "true"
								? '<i class="icon-is-active active"></i>行事曆狀態：罷免團體已接管'
								: '<i class="icon-is-active inactive"></i>行事曆狀態：等待罷免團體接管'}
						</div>
						<p>行事曆內容由該選區罷免團體接管後，陸續更新罷免最新活動。請新增行事曆並持續關注，不錯過罷免重要時程！</p>
						<div class="dialog-action">
							<a href="${calendarURL}" target="_blank"><button class="btn-primary lg w100">前往新增行事曆</button></a>
						</div>`;
					mask.classList.remove('active');
					showDialog();
				}));
			});
		});
	</script>
</body>
</html>
